{% extends "layout.html" %}
{% from "dataWithDefault.html" import dataWithDefault %}

{% block header %}

{% include "includes/cookie-banner.html" %}
{# Set serviceName in config.js. #}
{{ govukHeader({
  homepageUrl: "/",
  serviceName: serviceName,
  serviceUrl: "/cosmetics",
  containerClasses: "govuk-width-container"
}) }}
{% from "phase-banner/macro.njk" import govukPhaseBanner %}
<div class="govuk-width-container">  
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class='nav govuk-!-padding-top-2'>
        {% from "dataWithDefault.html" import dataWithDefault %}
        <h4 class='govuk-heading-s'>
          {{ dataWithDefault({
            value: data['responsible-person-name'],
            default: 'Example responsible person'
          })}}
        </h4>
        <p></p>
        <span class='nav-menu'>
          {% from "cosmetics/landing-page/sidebar.html" import sidebar %}
          {{ sidebar({
            pageId: 'notified-cosmetics'
          })}}
        </span>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
{% from "cosmetics/landing-page/sidebar.html" import sidebar %}
<div class="govuk-grid-row">
  {% if data['cpnp-upload'] and (data['refresh-count'] < 2) %}
  <div class='govuk-grid-column-full'>
    <div class="govuk-error-summary not-error-override" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
      <h2 class="govuk-error-summary__title" id="error-summary-title">
        <span class='active'></span> Checking {{ data['cpnp-upload'] | length }} notification files
      </h2>
      <div class="govuk-error-summary__body">
        <ul class="govuk-list">
          <a href="/cosmetics/landing-page/notified-cosmetics" class='govuk-link--no-visited-state'>Refresh the browser to see uploaded products</a>
        </ul>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">Your cosmetic products</h1>
  </div>
  <div class="govuk-grid-column-two-thirds">
    {% if not data['cpnp-upload'] %}
    <p>
      <strong>
        {{ dataWithDefault({
          value: data['responsible-person-name'],
          default: 'Example responsible person'
        })}}
      </strong> has no cosmetic products registered in the UK.
    </p>
    {% endif %}
    <p>
      All cosmetic products intended for sale or given away in the UK must be registered in the UK.
    </p>
    <p>
        To continue to sell or give away cosmetic products that were notified to the European Union (EU) before <span class='no-wrap'>29 March 2019</span>, you must register your products in the UK by <span class='no-wrap'>11:59pm on 27 June 2019</span>.
    </p> 
  </div>
  <div class="govuk-grid-column-two-thirds">
    <a href="/cosmetics/import/check-cpnp" role="button" draggable="false" class="govuk-button govuk-!-margin-top-4">
      Add cosmetic products
    </a>
  </div>
</div>
{% if data['cpnp-upload'] and (data['refresh-count'] >= 2) %}

{% set errorCosmeticProducts %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds govuk-!-margin-bottom-6">
    <h2 class="govuk-heading-l">
      Files that failed to upload
    </h2>
    <ul class='govuk-list'>
      <li class='govuk-!-padding-bottom-2'>
        <a href='/cosmetics/import/cpnp-export-upload' class='govuk-link--no-visited-state'>
          Try uploading files again
        </a>
      </li>
      <li>
        <a href='/cosmetics/dismiss-all-errors/' class='govuk-link--no-visited-state'>
          Dismiss all failed files
        </a>
      </li>
    </ul>
  </div>
  <div class='govuk-grid-column-full'>
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header" scope="col">
            Product name
          </th>
          <th class="govuk-table__header" scope="col">
            Reason for failure
          </th>
          <th class="govuk-table__header" scope="col">
          </th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for item in data['error-uploads'] %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
              {{ item['filename'] }}
          </td>
          <td class="govuk-table__cell">
              {{ item['reason'] }}
          </td>
          <td class="govuk-table__cell govuk-table__cell--numeric">
            <a href={{ '/cosmetics/dismiss-error/' + item['id'] }} class='govuk-link--no-visited-state'>
              Dismiss
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endset -%}


{% set draftCosmeticProducts %} 
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-l">Draft cosmetic products</h2>
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header govuk-!-width-one-third" scope="col">Product name</th>
          <th class="govuk-table__header width-one-sixth" scope="col">UK cosmetic product number</th>
          <th class="govuk-table__header width-one-sixth" scope="col">EU reference number</th>
          <th class="govuk-table__header width-one-sixth" scope="col">EU first notification date</th>
          <th class="govuk-table__header width-one-sixth" scope="col">Required files</th>
          <th class="govuk-table__header width-one-sixth" scope="col"></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for item in data['draft-uploads'] %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell" scope="row"><span class='capitalize'>{{ item['filename'] }}</span></th>
            <td class="govuk-table__cell">
              UKCP-{{ item['uk_product_number'] }}
            </td>
            <td class="govuk-table__cell">{{ item['cpnp_reference_number'] }}</td>
            <td class="govuk-table__cell">
                {{ item['date_notified'] }}
            </td>
            <td class="govuk-table__cell">
              <ul class='govuk-list'>
                <li>
                  Formulation
                </li>
                <li>
                  Packaging image
                </li>
                <li>
                  <a href={{ '/cosmetics/start-additional-files-upload/' + item['id'] }} class='govuk-link--no-visited-state'>Add files</a>
                </li>
              </ul>
            </td>
            <td class="govuk-table__cell govuk-table__cell--numeric">
              <a href='#' class='govuk-link--no-visited-state'>
                Edit
              </a>
            </td>
          </tr>
          {% endfor %}
          {# Last child shouldn't have a bottom border #}
        </tbody>
      </table>
      {% endset -%}

      {% set registeredCosmeticProducts %}
      <h2 class="govuk-heading-l">Registered cosmetic products</h2>
      <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th class="govuk-table__header govuk-!-width-one-third" scope="col">Product name</th>
              <th class="govuk-table__header width-one-sixth" scope="col">UK cosmetic product number</th>
              <th class="govuk-table__header width-one-sixth" scope="col">EU reference number</th>
              <th class="govuk-table__header width-one-sixth" scope="col"></th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            {% for item in data['completed-uploads'] %}
            <tr class="govuk-table__row">
              <td class="govuk-table__cell" scope="row"><span class='capitalize'>{{ item['filename'] }}</span></th>
                <td class="govuk-table__cell">
                  UKCP-{{ item['uk_product_number'] }}
                </td>
                <td class="govuk-table__cell">{{ item['cpnp_reference_number'] }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                  <a href='#' class='govuk-link--no-visited-state'>
                    Edit
                  </a>
                </td>
              </tr>
              {% endfor %}
              {# Last child shouldn't have a bottom border #}
            </tbody>
          </table>
      {% endset -%}

      {{ govukTabs({
        items: [
        {
          label: "Errors",
          id: "error-cosmetic-products",
          panel: {
          html: errorCosmeticProducts
        }
      },
        {
          label: "Draft",
          id: "draft-cosmetic-products",
          panel: {
          html: draftCosmeticProducts
        }
      },
      {
        label: "Registered",
        id: "registered-cosmetic-products",
        panel: {
        html: registeredCosmeticProducts
      }
    }
    ]
  }) }}
  {% endif %}
</div>
</div>
{% endblock %}
